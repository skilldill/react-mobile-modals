{"version":3,"sources":["../../src/Modals/Modals.context.ts","../../src/Modals/Modals.provider.tsx","../../src/Modals/Modal.tsx","../../src/hooks/useTouch.tsx","../../src/Modals/Modals.hook.ts","App.tsx","index.tsx"],"names":["ModalDirectionNames","ModalsContext","createContext","modals","openModal","closeModal","MIN_END_TOUCH","window","Modal","props","onClose","useState","config","initialConfig","startX","startY","translateX","translateY","transition","addTransitionAnimation","useCallback","transX","transY","delay","promiseAnimation","Promise","resolve","setStateTransition","setStateTranslateY","setStateTranslateX","cb","timeout","setTimeout","clearTimeout","handleTouchStart","event","touches","clientY","setStateStartX","setStateStartY","handleTouchMove","diffY","stateTranslateX","clientX","stateTranslateY","stateStartX","stateStartY","handleTouchEnd","stateTransition","useTouch","classes","show","modalClasses","modalStyle","useMemo","handleClosing","zIndex","transform","innerWidth","animated","close","onTouchStart","onTouchMove","onTouchEnd","setHandleClosing","setAnimated","translateTimeout","animatedTimeout","className","style","ModalsContextModeNames","ModalsProvider","children","lastModal","openedModals","i","setModals","closed","setMode","React","mode","modal","index","key","values","value","useModals","useContext","ThridModal","onClick","SecondModal","component","FirstModal","MainWindow","App","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.d3f67273.chunk.js","sourcesContent":["import { createContext, ReactNode } from \"react\";\n\nexport enum ModalDirectionNames {\n    horizontal = \"horizontal\", \n    vertical = \"vertical\"\n}\n\nexport interface ModalProps {\n    component: ReactNode,\n    openDirection?: ModalDirectionNames,\n    closed?: boolean\n}\n\nexport interface ModalContextModel {\n    modals: ModalProps[],\n    openModal: (modal: ModalProps) => void,\n    closeModal: () => void\n}\n\nexport const ModalsContext = createContext<ModalContextModel>({\n    modals: [],\n    openModal: () => {},\n    closeModal: () => {}\n})","import React, { FC, useMemo, useState } from \"react\";\n\nimport { ModalsContext, ModalProps } from \"./Modals.context\";\nimport { Modal } from \"./Modal\";\n\nenum ModalsContextModeNames {\n  close,\n  open,\n}\n\nexport const ModalsProvider: FC = ({ children }) => {\n  const [modals, setModals] = useState<ModalProps[]>([]);\n  const [mode, setMode] = useState<ModalsContextModeNames>(\n    ModalsContextModeNames.open\n  );\n\n  const openModal = (modal: ModalProps) => {\n    setMode(ModalsContextModeNames.open);\n    setModals([...modals, modal]);\n  };\n\n  const closeModal = () => {\n    const lastModal = modals[modals.length - 1];\n    const openedModals = modals.filter(\n      (modal, i) => {\n        modal // TODO: for linter)\n        return i !== modals.length - 1\n      }\n    );\n\n    setModals([...openedModals, { ...lastModal, closed: true }]);\n\n    const timeout = setTimeout(() => {\n      setMode(ModalsContextModeNames.close);\n      setModals(openedModals);\n      clearTimeout(timeout);\n    }, 300);\n  };\n\n  const openedModals = useMemo(\n    () => (\n      <React.Fragment>\n        {!!modals.length &&\n          (modals as ModalProps[]).map((modal, i) => (\n            <Modal \n              show={i === modals.length - 1 &&\n                mode === ModalsContextModeNames.open &&\n                !modal.closed}\n              close={!!modal.closed}\n              index={i}\n              key={i}\n              onClose={closeModal}\n            >{modal.component}</Modal>\n          ))}\n      </React.Fragment>\n    ),\n    [modals, mode]\n  );\n\n  const values = {\n    modals,\n    openModal,\n    closeModal,\n  };\n\n  return (\n    <ModalsContext.Provider value={values}>\n      <div className=\"modals\">\n        {children}\n        {openedModals}\n      </div>\n    </ModalsContext.Provider>\n  );\n};\n","import React, { CSSProperties, FC, useMemo, useState } from \"react\";\n\nimport { useTouch } from \"../hooks\";\nimport modalClasses from \"../styles.module.css\";\n\ninterface ModalProps {\n    index: number,\n    show: boolean,\n    close: boolean,\n    onClose: () => void\n}\n\nconst MIN_END_TOUCH = window.innerWidth * 0.7;\n\nconst MAX_TOUCH_LENGTH = 80;\n\nexport const Modal: FC<ModalProps> = (props) => {\n    const { children, index, close, show, onClose } = props;\n    const [handleClosing, setHandleClosing] = useState(false);\n    const [animated, setAnimated] = useState(false);\n\n    const {\n        stateStartX,\n        stateTranslateX,\n\n        setStateStartX,\n        setStateTranslateX,\n\n        handleTouchStart,\n        handleTouchMove,\n        handleTouchEnd,\n    } = useTouch();\n\n    const classes = show ? `${modalClasses['modal']} ${modalClasses['modal-show']}` : modalClasses['modal'];\n\n    const modalStyle: CSSProperties = useMemo(() => {\n        if (handleClosing || close) {\n            return {\n                zIndex: 1000 + index,\n                transition: 'all .2s',\n                transform: `translateX(${window.innerWidth}px)`\n            }\n        }\n\n        return {\n            zIndex: 1000 + index,\n            transition: animated ? 'all .2s' : 'none',\n            // stateTranslateX - stateStartX > 0 чтобы не тянуть в обратную сторону\n            transform: stateStartX < MIN_END_TOUCH && stateTranslateX - stateStartX > 0 ? `translateX(${stateTranslateX}px)` : 'none'\n        }\n    }, [handleClosing, close, stateStartX, stateTranslateX, index])\n\n    const onTouchEnd = () => {\n        const touchMoveLength = stateTranslateX - stateStartX;\n\n        if (stateStartX < MIN_END_TOUCH && touchMoveLength > MAX_TOUCH_LENGTH) {\n            setHandleClosing(true);\n            onClose();\n        } else {\n            setAnimated(true);\n\n            const translateTimeout = setTimeout(() => {\n                setStateStartX(0);\n                setStateTranslateX(0);\n                clearTimeout(translateTimeout);\n            }, 10);\n\n            const animatedTimeout = setTimeout(() => {\n                setAnimated(false);\n                clearTimeout(animatedTimeout);\n            }, 200)\n        }\n    };\n\n    return (\n        <div\n            onTouchStart={handleTouchStart()}\n            onTouchMove={handleTouchMove()}\n            onTouchEnd={handleTouchEnd(onTouchEnd)}\n            className={classes}\n            style={modalStyle}\n        >\n            {children}\n        </div>\n    )\n}","import { useState, useCallback, TouchEvent } from \"react\";\n\ninterface useTouchConfig {\n  startX?: number,\n  startY?: number,\n  translateX?: number,\n  translateY?: number,\n  transition?: boolean,\n}\n\nexport const useTouch = (config?: useTouchConfig) => {\n  let initialConfig = { startX: 0, startY: 0, translateX: 0, translateY: 0, transition: false };\n  if (!!config) initialConfig = { ...initialConfig, ...config };\n  const { startX, startY, translateX, translateY, transition } = initialConfig;\n\n  const [stateStartX, setStateStartX] = useState(startX);\n  const [stateStartY, setStateStartY] = useState(startY);\n  const [stateTranslateX, setStateTranslateX] = useState(translateX);\n  const [stateTranslateY, setStateTranslateY] = useState(translateY);\n  const [stateTransition, setStateTransition] = useState(transition);\n\n  const addTransitionAnimation = useCallback((cb?: () => void, transX: number = translateX, transY: number = translateY, delay = 400) => {\n    const promiseAnimation = new Promise<NodeJS.Timeout>((resolve) => {\n      setStateTransition(true);\n        setStateTranslateY(transY);\n        setStateTranslateX(transX);\n\n        !!cb && cb();\n\n        const timeout = setTimeout(() => {\n            resolve(timeout);\n        }, delay);\n    })\n\n    promiseAnimation\n        .then((timeout) => {\n            clearTimeout(timeout);\n            setStateTransition(false);\n        })\n  }, [])\n\n  const handleTouchStart = useCallback((cb?: () => void) => (event: TouchEvent) => {\n    const { touches } = event;\n    const { clientX, clientY } = touches[0];\n\n    !!cb && cb();\n\n    setStateStartX(clientX);\n    setStateStartY(clientY);\n  }, [setStateStartX, setStateStartY])\n\n  const handleTouchMove = useCallback((cb?: () => void) => (event: TouchEvent) => {\n    const { touches } = event;\n    const { clientX, clientY } = touches[0];\n\n    const diffX = clientX - stateStartX;\n    const diffY = clientY - stateStartY;\n\n    setStateTranslateX(stateTranslateX + diffX);\n    setStateTranslateY(stateTranslateY + diffY);\n\n    !!cb && cb();\n  }, [stateStartX, stateStartY, setStateTranslateX, setStateTranslateY])\n\n  const handleTouchEnd = (cb?: () => void) => () => {\n    !!cb && cb();\n  }\n\n  return {\n    handleTouchStart,\n    handleTouchMove,\n    handleTouchEnd,\n    addTransitionAnimation,\n    \n    setStateTranslateX,\n    setStateTranslateY,\n    setStateTransition,\n\n    setStateStartX,\n    setStateStartY,\n\n    stateStartX,\n    stateStartY,\n    stateTranslateX,\n    stateTranslateY,\n    stateTransition\n  }\n}","import { useContext } from \"react\";\nimport { ModalsContext } from \"./Modals.context\";\n\n\nexport const useModals = () => {\n    const modals = useContext(ModalsContext);\n    return modals;\n}","import React from 'react';\nimport { ModalsProvider, useModals } from 'react-mobile-modals';\nimport \"react-mobile-modals/dist/index.css\";\n\nimport \"./index.css\";\n\nconst ThridModal = () => {\n  const { closeModal } = useModals();\n\n  return (\n    <div className=\"page page-blue\">\n      <button onClick={closeModal}>\n        Back\n      </button>\n    </div>\n  )\n}\n\nconst SecondModal = () => {\n  const { openModal } = useModals();\n\n  const openThridModal = () => openModal({ component: <ThridModal /> });\n\n  return (\n    <div className=\"page page-red\">\n      <button onClick={openThridModal}>\n        Open thrid modal\n      </button>\n    </div>  \n  )\n}\n\nconst FirstModal = () => {\n  const { openModal } = useModals();\n\n  const openSecondModal = () => openModal({ component: <SecondModal /> });\n\n  return (\n    <div className=\"page page-green\">\n      <button onClick={openSecondModal}>\n        Open second modal\n      </button>\n    </div>  \n  )\n}\n\nconst MainWindow = () => {\n  const { openModal } = useModals();\n\n  const openFirstModal = () => openModal({ component: <FirstModal /> });\n\n  return (\n    <div className=\"page main\">\n      <button onClick={openFirstModal}>\n        Open first modal\n      </button>\n    </div>\n  )\n}\n\nconst App = () => {\n  return (\n    <ModalsProvider>\n      <MainWindow />\n    </ModalsProvider>\n  )\n}\n\nexport default App\n","import './index.css'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n"],"sourceRoot":""}